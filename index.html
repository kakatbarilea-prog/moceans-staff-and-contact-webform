<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MOCEANS — Contact & Activity Form</title>

<style>
  /* =========================
     THEME & QUICK TWEAKS
     ========================= */
  :root{
    --page-bg:#ffffff;
    --ink:#1f2937;

    /* >>> Adjust the header logo width here. Height will auto-scale. */
    --logo-width: 220px;

    /* Footer */
    --footer-bg:#2f2e2e;
    --footer-ink:#ffffff;
    --footer-ink-muted: rgba(255,255,255,.8);
    --footer-link:#ffffff;
    --footer-link-hover:#ffffff;
    --footer-line: rgba(255,255,255,.18);

    /* Layout */
    --container-pad: 20px;
    --footer-maxw: 1200px;
    --gap: 16px;

    /* Form */
    --card-maxw: 820px;
    --card-pad: 22px;
    --card-radius: 14px;
    --card-shadow: 0 20px 40px rgba(0,0,0,.08), 0 2px 8px rgba(0,0,0,.06);
    --field-bg:#ffffff;
    --field-line:#e6e8eb;
    --field-radius: 10px;

    /* Buttons */
    --btn-bg:#097095;         /* <<< Submit button color */
    --btn-bg-hover:#085a77;
    --btn-ink:#ffffff;

    /* Bubble selector */
    --bubble-bg:#f3f5f7;
    --bubble-ink:#334155;
    --bubble-active-bg:#097095;
    --bubble-active-ink:#ffffff;
    --bubble-border:#d9dee3;
  }

  /* Base */
  *{box-sizing:border-box}
  html, body{
    margin:0;
    background:var(--page-bg);
    color:var(--ink);
    font-family: Calibri, "Segoe UI", system-ui, -apple-system, Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height:1.5;
  }
  img{display:block; max-width:100%; height:auto}
  a{color:var(--footer-link); text-decoration:none}
  a:hover{opacity:.9}

  /* Header */
  header.site-header{
    width:100%;
    background:#ffffff;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px 16px;
    border-bottom:1px solid #ececec;
    position:sticky;
    top:0;
    z-index:10;
  }
  .site-logo{
    width:var(--logo-width); /* <<< change this in :root to resize */
    margin:auto;
  }

  /* ===== Assign Navigator area (hidden until staff submit) ===== */
  .assign-bar{ width:100%; }
  /* Outer gutters so the box doesn't touch the screen edges */
  .assign-outer{
    padding-left: clamp(16px, 4vw, 32px);
    padding-right: clamp(16px, 4vw, 32px);
    padding-top: 16px;
    padding-bottom: 0;
  }
  /* The actual white card */
  .assign-box{
    background:#fff;
    border:1px solid rgba(0,0,0,.06);
    border-radius: var(--card-radius);
    box-shadow: var(--card-shadow);
    padding:16px 20px;
  }
  .assign-grid{
    display:grid;
    grid-template-columns: 1fr auto;
    gap:16px;
    align-items:start;
  }
  .assign-title{
    margin:0 0 8px 0;
    font-size:22px;
    line-height:1.25;
    font-weight:700;
  }
  .chip-row{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .chip{
    background:#eef2f6;
    border:1px solid #d9dee3;
    color:#334155;
    font-weight:700;
    font-size:14px;
    padding:6px 10px;
    border-radius:999px;
  }
  /* Right side metadata: aligned starting point with a 2-col grid */
  .assign-right{
    display:grid;
    grid-template-columns: max-content 1fr;
    gap:6px 10px;
    align-items:start;
  }
  .assign-right .k{ color:#374151; font-weight:700; }
  .assign-right .v{ color:var(--ink); }
  @media (max-width: 700px){
    .assign-grid{ grid-template-columns: 1fr; }
    .assign-right{ grid-template-columns: max-content 1fr; }
  }
.assign-right .v{
  justify-self: end;
  text-align: right;
}

  /* ===== NEW: Navigator cards grid ===== */
  .cards-outer{
    padding-left: clamp(16px, 4vw, 32px);
    padding-right: clamp(16px, 4vw, 32px);
    padding-top: 16px;
    padding-bottom: 24px;
  }
  .cards-grid{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
  }
  @media (max-width: 1100px){
    .cards-grid{ grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 700px){
    .cards-grid{ grid-template-columns: 1fr; }
  }
  .nav-card{
    background:#fff;
    border:1px solid rgba(0,0,0,.06);
    border-radius: var(--card-radius);
    box-shadow: var(--card-shadow);
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .nav-top{
    display:grid;
    grid-template-columns: 64px 1fr;
    gap:12px;
    align-items:center;
  }
  .nav-top img{
    width:64px; height:64px; object-fit:cover; border-radius:999px;
  }
  .nav-id{
    display:flex;
    flex-direction:column;
    justify-content:space-between;  /* aligns three lines to fill same height as headshot */
    height:64px;                    /* match headshot height */
  }
  .nav-id .name{ font-weight:700; }
  .meta-row{
    display:grid;
    grid-template-columns: 1fr auto;
    align-items:center;
    font-size:14px;
  }
  .meta-row .k{ color:#6b7280; }   /* dark gray label */
  .meta-row .v{ font-weight:700; color:#111827; } /* bold black number/value */

  /* NEW: straight progress line (replaces sparkline) */
  .progressbar{
    width:100%;
    height:10px;
    margin:10px 0;               /* equal space above and below */
    background:#eef2f6;          /* track */
    border-radius:999px;
    overflow:hidden;
    position:relative;
  }
  .progressfill{
    position:absolute;
    left:0; top:0; bottom:0;
    width:0;                      /* set via JS */
    background:#097095;           /* fill */
    border-radius:999px;
    transition: width .4s ease;
  }

  /* Main layout */
  main{
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding: 32px 16px 60px;
    min-height: 60vh;
    background:#ffffff;
  }

  .form-wrap{
    width:100%;
    max-width:var(--card-maxw);
  }

  .card{
    background:#fff;
    border:1px solid rgba(0,0,0,.06);
    border-radius:var(--card-radius);
    box-shadow:var(--card-shadow);
    padding:var(--card-pad);
  }

  h1, h2{
    margin:0 0 16px 0;
    line-height:1.25;
    font-weight:700;
  }
  h1{ font-size:28px }
  h2{ font-size:22px }

  .stack{ display:grid; gap:16px }
  .row{ display:grid; grid-template-columns:1fr 1fr; gap:16px }
  @media (max-width: 640px){ .row{ grid-template-columns:1fr } }

  label{
    font-size:14px;
    font-weight:600;
    margin-bottom:6px;
    display:block;
  }
  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="file"],
  input[type="number"],
  textarea,
  select{
    width:100%;
    background:var(--field-bg);
    border:1px solid var(--field-line);
    border-radius:var(--field-radius);
    padding:12px 12px;
    font-size:16px;
    outline:none;
    transition:border-color .15s ease, box-shadow .15s ease;
  }
  /* Make selects visually match inputs (thicker, with chevron) */
  select{
    -webkit-appearance:none;
    -moz-appearance:none;
    appearance:none;
    padding-right:38px; /* room for chevron */
    background-image:
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%23697b8c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');
    background-repeat:no-repeat;
    background-position: right 10px center;
    background-size:16px;
  }
  textarea{ min-height:120px; resize:vertical }
  input:focus, textarea:focus, select:focus{
    border-color:#c5d7df;
    box-shadow:0 0 0 4px rgba(9,112,149,.08);
  }

  .actions{
    margin-top:8px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  .btn{
    appearance:none; border:none; cursor:pointer;
    background:var(--btn-bg); color:var(--btn-ink);
    padding:12px 18px; border-radius:10px; font-weight:700; font-size:16px;
    transition:transform .08s ease, background .15s ease, box-shadow .15s ease;
    box-shadow:0 6px 16px rgba(9,112,149,.25);
  }
  .btn:hover{ background:var(--btn-bg-hover) }
  .btn:active{ transform: translateY(1px) }

  .below-card{
    margin-top:12px; text-align:center; font-size:15px;
  }
  .below-card a{
    color:#097095; font-weight:700; text-decoration:underline;
  }

  /* Bubble selector (logged-in) */
  .bubble-row{
    display:flex; gap:10px; flex-wrap:wrap; margin:8px 0 14px 0;
  }
  .bubble{
    display:inline-flex; align-items:center; justify-content:center;
    padding:10px 14px; border-radius:999px; border:1px solid var(--bubble-border);
    background:var(--bubble-bg); color:var(--bubble-ink);
    font-weight:700; cursor:pointer; user-select:none;
    transition:background .15s ease, color .15s ease, border-color .15s ease;
  }
  .bubble[aria-pressed="true"]{
    background:var(--bubble-active-bg); color:var(--bubble-active-ink);
    border-color:transparent;
  }

  .divider{ height:1px; background:#eceff2; margin:14px 0 4px 0 }

  /* Footer */
  footer.site-footer{
    background:#2f2e2e;
    color:#ffffff;
  }
  .footer-inner{
    max-width:var(--footer-maxw);
    margin:0 auto;
    padding:32px var(--container-pad);
  }

  .footer-row{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:var(--gap);
    align-items:start;
  }

  .footer-left{
    display:flex;
    flex-direction:column;
    gap:14px;
  }
  .socials{
    display:flex;
    align-items:center;
    gap:14px;
  }
  .social-link{
    width:28px; height:28px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    border-radius:6px;
    transition:transform .15s ease, opacity .15s ease;
  }
  .social-link:hover{ transform: translateY(-1px); opacity:.9 }
  .social-link svg{ width:22px; height:22px; fill:#ffffff }

  .copyright{
    font-size:14px;
    color:var(--footer-ink-muted);
  }

  .footer-right{
    text-align:right;
    color:#ffffff;
  }
  .footer-right p{ margin:0 0 6px 0 }
  .footer-right .muted{ color:var(--footer-ink-muted) }

  .footer-divider{
    height:1px;
    background:var(--footer-line);
    margin:20px 0;
  }
  .footer-bottom{
    display:flex;
    gap:24px;
    flex-wrap:wrap;
    justify-content:center;
    padding-bottom:6px;
  }
  .footer-bottom a{
    color:var(--footer-link);
    font-weight:600;
  }
  .footer-bottom a:hover{
    color:var(--footer-link-hover);
    text-decoration:underline;
  }

  @media (max-width: 820px){
    .footer-row{ grid-template-columns: 1fr; gap:24px }
    .footer-right{ text-align:left }
  }
</style>
</head>
<body>

  <!-- Header -->
  <header class="site-header" role="banner">
    <a href="/" class="site-logo" aria-label="MOCEANS Home">
      <img src="https://d34hmiuaex7c0.cloudfront.net/2952/uploads/cmaspages/gallery/galleryitem_1759958511694.png" alt="MOCEANS Logo">
    </a>
  </header>

  <!-- ===== Assign Navigator Panel (initially hidden) ===== -->
  <section id="assignBar" class="assign-bar" hidden>
    <div class="assign-outer">
      <div class="assign-box">
        <div class="assign-grid">
          <div>
            <h2 class="assign-title" id="assignTitle">Assign Navigator for </h2>
            <div class="chip-row">
              <span class="chip" id="chipPriority">Emergency</span>
              <span class="chip" id="chipSource">Source: Call</span>
              <span class="chip" id="chipPrimary">Primary Issue: —</span>
              <span class="chip" id="chipCounty">City/County: —</span>
            </div>
          </div>
          <div class="assign-right" aria-label="Submission metadata">
            <span class="k">Inquiry Received Date:</span><span class="v" id="assignDate"></span>
            <span class="k">Entered By:</span><span class="v" id="assignOwner">[owner_firstname] [owner_lastname]</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== NEW: Cards area (initially hidden) ===== -->
  <section id="assignCards" hidden>
    <div class="cards-outer">
      <div class="cards-grid" id="cardsGrid"></div>
    </div>
  </section>

  <!-- Main -->
  <main role="main">
    <div class="form-wrap">
      
      <!-- =============== Non-Logged-In State =============== -->
      <section id="guestForm" class="card" aria-labelledby="guestHeading">
        <h1 id="guestHeading">Contact / Activity Form</h1>
        <form class="stack" onsubmit="return handleGuestSubmit(event)">
          <!-- Priority row -->
          <div>
            <label>Priority</label>
            <div style="display:flex; gap:12px; flex-wrap:wrap;">
              <label><input type="radio" name="g_priority" value="Emergency"> Emergency</label>
              <label><input type="radio" name="g_priority" value="Urgent"> Urgent</label>
              <label><input type="radio" name="g_priority" value="Non-Emergency"> Non-Emergency</label>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="g-first">First Name</label>
              <input id="g-first" type="text" name="first_name" autocomplete="given-name" />
            </div>
            <div>
              <label for="g-last">Last Name</label>
              <input id="g-last" type="text" name="last_name" autocomplete="family-name" />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="g-email">Email</label>
              <input id="g-email" type="email" name="email" autocomplete="email" />
            </div>
            <div>
              <label for="g-phone">Phone</label>
              <input id="g-phone" type="tel" name="phone" autocomplete="tel" />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="g-preferred">Preferred Contact Method</label>
              <select id="g-preferred" name="preferred_contact_method">
                <option value="">Please select</option>
                <option>Phone</option>
                <option>Email</option>
                <option>Text</option>
                <option>No preference</option>
              </select>
            </div>
            <div>
              <label for="g-gender">Gender</label>
              <select id="g-gender" name="gender">
                <option value="">Please select</option>
                <option>Female</option>
                <option>Male</option>
                <option>Non-binary</option>
                <option>Prefer not to say</option>
                <option>Other</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="g-age">Age</label>
              <input id="g-age" type="number" name="age" min="0" />
            </div>
            <div>
              <label for="g-county-city">County or City</label>
              <input id="g-county-city" type="text" name="county_or_city" />
            </div>
          </div>

          <div>
            <label for="g-primary">Primary Issue</label>
            <select id="g-primary" name="primary_issue">
              <option value="">Please select</option>
              <option>Housing Assistance</option>
              <option>Employment</option>
              <option>Transportation</option>
              <option>Personal Care Support</option>
              <option>Assistive Technology</option>
              <option>Benefits / Financial Assistance</option>
              <option>Education / Training</option>
              <option>Advocacy / Legal Rights</option>
              <option>Health & Wellness</option>
              <option>Other</option>
            </select>
          </div>

          <div id="g-primary-other-wrap" style="display:none;">
            <label for="g-primary-other">Please specify (Other)</label>
            <input id="g-primary-other" type="text" name="primary_issue_other" />
          </div>

          <div>
            <label for="g-summary">Summary of Need</label>
            <textarea id="g-summary" name="summary_of_need"></textarea>
          </div>

          <div>
            <label for="g-notes">Additional Notes</label>
            <textarea id="g-notes" name="additional_notes"></textarea>
          </div>

          <div>
            <label for="g-files">Share any attachments</label>
            <input id="g-files" type="file" name="attachments" multiple />
          </div>

          <div class="actions">
            <button class="btn" type="submit">Submit</button>
          </div>
        </form>
      </section>

      <div class="below-card" id="guestBelow">
        <a id="staffLink" href="#">For Staffs, Log-in here</a>
      </div>

      <!-- Spacing between cards -->
      <div style="height:28px"></div>

      <!-- ================ Logged-In State ================= -->
      <section id="staffForm" class="card" aria-labelledby="staffHeading" hidden>
        <h1 id="staffHeading">Internal Staff Activity Logging</h1>

        <!-- Bubbles (modes remain, fields below are the same for any mode) -->
        <div class="bubble-row" role="tablist" aria-label="Select activity type">
          <button class="bubble" role="tab" aria-selected="true" aria-pressed="true" data-mode="call">Log a Call</button>
          <button class="bubble" role="tab" aria-selected="false" aria-pressed="false" data-mode="email">Log an Email</button>
          <button class="bubble" role="tab" aria-selected="false" aria-pressed="false" data-mode="text">Log a Text</button>
          <button class="bubble" role="tab" aria-selected="false" aria-pressed="false" data-mode="slack">Log a Slack Message</button>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <!-- Fields (same for any selected mode) -->
        <form id="staffDynamic" class="stack" onsubmit="return handleStaffSubmit(event)">
          <!-- Priority row -->
          <div>
            <label>Priority</label>
            <div style="display:flex; gap:12px; flex-wrap:wrap;">
              <label><input type="radio" name="s_priority" value="Emergency"> Emergency</label>
              <label><input type="radio" name="s_priority" value="Urgent"> Urgent</label>
              <label><input type="radio" name="s_priority" value="Non-Emergency"> Non-Emergency</label>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="s-first">First Name</label>
              <input id="s-first" type="text" name="first_name" autocomplete="given-name" />
            </div>
            <div>
              <label for="s-last">Last Name</label>
              <input id="s-last" type="text" name="last_name" autocomplete="family-name" />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="s-email">Email</label>
              <input id="s-email" type="email" name="email" autocomplete="email" />
            </div>
            <div>
              <label for="s-phone">Phone</label>
              <input id="s-phone" type="tel" name="phone" autocomplete="tel" />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="s-preferred">Preferred Contact Method</label>
              <select id="s-preferred" name="preferred_contact_method">
                <option value="">Please select</option>
                <option>Phone</option>
                <option>Email</option>
                <option>Text</option>
                <option>No preference</option>
              </select>
            </div>
            <div>
              <label for="s-gender">Gender</label>
              <select id="s-gender" name="gender">
                <option value="">Please select</option>
                <option>Female</option>
                <option>Male</option>
                <option>Non-binary</option>
                <option>Prefer not to say</option>
                <option>Other</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="s-age">Age</label>
              <input id="s-age" type="number" name="age" min="0" />
            </div>
            <div>
              <label for="s-county-city">County or City</label>
              <input id="s-county-city" type="text" name="county_or_city" />
            </div>
          </div>

          <div>
            <label for="s-primary">Primary Issue</label>
            <select id="s-primary" name="primary_issue">
              <option value="">Please select</option>
              <option>Housing Assistance</option>
              <option>Employment</option>
              <option>Transportation</option>
              <option>Personal Care Support</option>
              <option>Assistive Technology</option>
              <option>Benefits / Financial Assistance</option>
              <option>Education / Training</option>
              <option>Advocacy / Legal Rights</option>
              <option>Health & Wellness</option>
              <option>Other</option>
            </select>
          </div>

          <div id="s-primary-other-wrap" style="display:none;">
            <label for="s-primary-other">Please specify (Other)</label>
            <input id="s-primary-other" type="text" name="primary_issue_other" />
          </div>

          <div>
            <label for="s-summary">Summary of Need</label>
            <textarea id="s-summary" name="summary_of_need"></textarea>
          </div>

          <div>
            <label for="s-notes">Additional Notes</label>
            <textarea id="s-notes" name="additional_notes"></textarea>
          </div>

          <div>
            <label for="s-files">Share any attachments</label>
            <input id="s-files" type="file" name="attachments" multiple />
          </div>

          <div class="actions">
            <button class="btn" type="submit">Submit Log</button>
          </div>
        </form>
      </section>

      <div class="below-card" id="staffBelow" hidden>
        <a id="logoutLink" href="#">Log out</a>
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer" role="contentinfo">
    <div class="footer-inner">
      <div class="footer-row">
        <!-- Left: Social icons + © -->
        <div class="footer-left">
          <nav class="socials" aria-label="Social media">
            <a class="social-link" href="https://www.facebook.com/MoceansCIL" aria-label="Facebook" target="_blank" rel="noopener">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M22 12.06C22 6.49 17.52 2 11.94 2S2 6.49 2 12.06C2 17.08 5.66 21.19 10.44 22v-7.02H7.9v-2.92h2.54V9.41c0-2.5 1.49-3.88 3.77-3.88 1.09 0 2.24.2 2.24.2v2.46h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.44 2.92h-2.34V22C18.34 21.19 22 17.08 22 12.06z"/>
              </svg>
            </a>
            <a class="social-link" href="https://www.instagram.com/moceans_cil/" aria-label="Instagram" target="_blank" rel="noopener">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 3.5A5.5 5.5 5.5 0 1 1 6.5 13 5.51 5.51 0 0 1 12 7.5zm0 2A3.5 3.5 0 1 0 15.5 13 3.5 3.5 0 0 0 12 9.5zM18 6.4a1.1 1.1 0 1 1-1.1 1.1A1.1 1.1 0 0 1 18 6.4z"/>
              </svg>
            </a>
            <a class="social-link" href="https://www.linkedin.com/company/moceanscil" aria-label="LinkedIn" target="_blank" rel="noopener">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM0 8.99h5V24H0zM8.99 8.99h4.79v2.05h.07c.67-1.26 2.3-2.6 4.73-2.6 5.06 0 6 3.33 6 7.67V24h-5v-6.67c0-1.59-.03-3.63-2.21-3.63-2.21 0-2.55 1.73-2.55 3.52V24h-5z"/>
              </svg>
            </a>
          </nav>
          <div class="copyright">© 2025 MOCEANS</div>
        </div>

        <!-- Right: Address / Phone / EIN -->
        <div class="footer-right">
          <p>213&nbsp;Broadway, Long&nbsp;Branch, NJ&nbsp;07740</p>
          <p>Phone: (732) 571-4884</p>
          <p class="muted">EIN 22-3468867&nbsp;&nbsp; #CH1042000</p>
        </div>
      </div>

      <div class="footer-divider" aria-hidden="true"></div>

      <div class="footer-bottom" aria-label="Policies">
        <a href="https://www.moceanscil.org/privacy-policy" target="_blank" rel="noopener">Privacy Policy</a>
        <a href="https://www.moceanscil.org/communications-policy" target="_blank" rel="noopener">Communication Policy</a>
      </div>
    </div>
  </footer>

  <!-- Script -->
  <script>
    // -------- Editable owner (placeholder shown on Assign bar)
    const OWNER_FIRSTNAME = '[owner_firstname]';
    const OWNER_LASTNAME  = '[owner_lastname]';

    // -------- State toggle helpers
    const guestForm = document.getElementById('guestForm');
    const staffForm = document.getElementById('staffForm');
    const staffLink = document.getElementById('staffLink');
    const modeFields = document.getElementById('modeFields');
    const guestBelow = document.getElementById('guestBelow');
    const staffBelow = document.getElementById('staffBelow');
    const logoutLink = document.getElementById('logoutLink');

    // Assign Navigator panel refs
    const assignBar   = document.getElementById('assignBar');
    const assignTitle = document.getElementById('assignTitle');
    const chipPriority= document.getElementById('chipPriority');
    const chipSource  = document.getElementById('chipSource');
    const chipPrimary = document.getElementById('chipPrimary');
    const chipCounty  = document.getElementById('chipCounty');
    const assignDate  = document.getElementById('assignDate');
    const assignOwner = document.getElementById('assignOwner');

    // Cards area
    const assignCards = document.getElementById('assignCards');
    const cardsGrid   = document.getElementById('cardsGrid');

    const staffDynamic = document.getElementById('staffDynamic');
    const bubbleButtons = () => Array.from(staffForm.querySelectorAll('.bubble'));

    function showState(state){
      const isStaff = state === 'staff';
      staffForm.hidden = !isStaff;
      guestForm.hidden = isStaff;

      // Toggle below-card links (login vs logout)
      if (guestBelow) guestBelow.hidden = isStaff;
      if (staffBelow) staffBelow.hidden = !isStaff;

      // Hide Assign panel and cards if leaving staff state
      if (!isStaff && assignBar) assignBar.hidden = true;
      if (!isStaff && assignCards) assignCards.hidden = true;

      if(isStaff){ ensureMode('call'); }
    }

    function syncFromHash(){
      const hash = (location.hash || '').replace('#','').toLowerCase();
      showState(hash === 'staff' ? 'staff' : 'guest');
      if(hash.startsWith('staff-')){
        const m = hash.split('-')[1];
        ensureMode(m);
      }
    }

    if (staffLink) {
      staffLink.addEventListener('click', (e) => {
        e.preventDefault();
        showState('staff');
      });
    }

    if (logoutLink) {
      logoutLink.addEventListener('click', (e) => {
        e.preventDefault();
        showState('guest');
      });
    }

    // Mode templates (kept empty to preserve structure)
    const templates = { call: ``, email: ``, text: ``, slack: `` };

    function ensureMode(mode){
      const valid = ['call','email','text','slack'];
      const m = valid.includes(mode) ? mode : 'call';
      bubbleButtons().forEach(btn => {
        const active = btn.dataset.mode === m;
        btn.setAttribute('aria-pressed', active ? 'true' : 'false');
        btn.setAttribute('aria-selected', active ? 'true' : 'false');
      });
      modeFields.innerHTML = templates[m];
    }

    bubbleButtons().forEach(btn => {
      btn.addEventListener('click', () => ensureMode(btn.dataset.mode));
    });

    // Primary Issue: show/hide "Other" text boxes
    function wirePrimaryIssue(selectId, wrapId){
      const sel = document.getElementById(selectId);
      const wrap = document.getElementById(wrapId);
      if(!sel || !wrap) return;
      const sync = () => {
        const v = sel.value.trim().toLowerCase();
        wrap.style.display = (v === 'other') ? 'block' : 'none';
      };
      sel.addEventListener('change', sync);
      sync();
    }
    wirePrimaryIssue('g-primary','g-primary-other-wrap');
    wirePrimaryIssue('s-primary','s-primary-other-wrap');

    // ===== Dummy data for 6 cards
    const NAVIGATORS = [
      {
        headshot:'https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=256&auto=format&fit=crop',
        name:'Katrina Lewis',
        email:'katrina.lewis@moceanscil.org',
        phone:'(732) 555-2031',
        active:5, pending:0, lastAssigned:'Oct 9 2025'
      },
      {
        headshot:'https://d34hmiuaex7c0.cloudfront.net/2952/uploads/profile/staffuser/3395/1662043848061.jpeg?q=80&w=256&auto=format&fit=crop',
        name:'Pete Romano',
        email:'pete.romano@moceanscil.org',
        phone:'(732) 555-2114',
        active:7, pending:1, lastAssigned:'Oct 10 2025'
      },
      {
        headshot:'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=256&auto=format&fit=crop',
        name:'Maria Rivera',
        email:'maria.rivera@moceanscil.org',
        phone:'(732) 555-2147',
        active:9, pending:2, lastAssigned:'Oct 7 2025'
      },
      {
        headshot:'https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?q=80&w=256&auto=format&fit=crop',
        name:'Deon James',
        email:'deon.james@moceanscil.org',
        phone:'(732) 555-2073',
        active:3, pending:0, lastAssigned:'Oct 8 2025'
      },
      {
        headshot:'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=256&auto=format&fit=crop',
        name:'Anika Shah',
        email:'anika.shah@moceanscil.org',
        phone:'(732) 555-2195',
        active:6, pending:1, lastAssigned:'Oct 6 2025'
      },
      {
        headshot:'https://images.unsplash.com/photo-1552058544-f2b08422138a?q=80&w=256&auto=format&fit=crop',
        name:'Owen Price',
        email:'owen.price@moceanscil.org',
        phone:'(732) 555-2059',
        active:8, pending:2, lastAssigned:'Oct 5 2025'
      }
    ];

    // Helper: render straight progress line proportional to active cases
    function makeProgressBar(active, maxActive){
      const wrap = document.createElement('div');
      wrap.className = 'progressbar';
      const fill = document.createElement('div');
      fill.className = 'progressfill';
      const pct = Math.max(0, Math.min(100, (active / (maxActive || 1)) * 100));
      fill.style.width = pct + '%';
      wrap.appendChild(fill);
      return wrap;
    }

    function renderCards(){
      if(!cardsGrid) return;
      cardsGrid.innerHTML = '';

      // Determine max to scale bars (simple: use highest Active Cases)
      const maxActive = Math.max(...NAVIGATORS.map(n => n.active), 1);

      NAVIGATORS.forEach(nav => {
        const card = document.createElement('div');
        card.className = 'nav-card';

        card.innerHTML = `
          <div class="nav-top">
            <img src="${nav.headshot}" alt="${nav.name} headshot">
            <div class="nav-id">
              <div class="name">${nav.name}</div>
              <div class="email">${nav.email}</div>
              <div class="phone">${nav.phone}</div>
            </div>
          </div>

          <div class="meta-row">
            <span class="k">Active Cases</span>
            <span class="v">${nav.active}</span>
          </div>
        `;

        // Insert the straight progress line
        const bar = makeProgressBar(nav.active, maxActive);
        card.appendChild(bar);

        // Continue rest of the rows
        const pending = document.createElement('div');
        pending.className = 'meta-row';
        pending.innerHTML = `<span class="k">Pending Acceptances</span><span class="v">${nav.pending}</span>`;
        card.appendChild(pending);

        const last = document.createElement('div');
        last.className = 'meta-row';
        last.style.marginTop = '8px';
        last.innerHTML = `<span class="k">Last Assigned</span><span class="v">${nav.lastAssigned}</span>`;
        card.appendChild(last);

        const btn = document.createElement('button');
        btn.className = 'btn assign-btn';
        btn.type = 'button';
        btn.textContent = `Assign to ${nav.name}`;
        card.appendChild(btn);

        cardsGrid.appendChild(card);
      });
    }

    // Dummy submit handlers (prevent page reload for now)
    function handleGuestSubmit(e){
      e.preventDefault();
      alert('Submitted Contact / Activity Form (demo).');
      return false;
    }

    function handleStaffSubmit(e){
      e.preventDefault();

      // Read active source (mode bubble)
      const activeMode = bubbleButtons().find(b => b.getAttribute('aria-pressed') === 'true')?.dataset.mode || 'call';
      const sourceLabel = { call:'Call', email:'Email', text:'Text', slack:'Slack' }[activeMode] || 'Call';

      // Read form values
      const first = document.getElementById('s-first')?.value?.trim() || '';
      const last  = document.getElementById('s-last')?.value?.trim() || '';

      // Priority radio
      const fd = new FormData(staffDynamic);
      const priority = (fd.get('s_priority') || '').toString();

      // Primary issue & county/city
      const primary = document.getElementById('s-primary')?.value || '';
      const county  = document.getElementById('s-county-city')?.value?.trim() || '';

      // Fill Assign Navigator bar
      if (assignBar) {
        assignTitle.textContent = `Assign Navigator for: ${first || '—'} ${last || ''}`.trim();
        chipPriority.textContent = priority || '—';
        chipSource.textContent   = `Source: ${sourceLabel}`;
        chipPrimary.textContent  = `Primary Issue: ${primary || '—'}`;
        chipCounty.textContent   = `City/County: ${county || '—'}`;

        // Date/time now (local)
        const now = new Date();
        assignDate.textContent = now.toLocaleString();

        // Owner placeholder
        assignOwner.textContent = `${OWNER_FIRSTNAME} ${OWNER_LASTNAME}`;

        // Show panel
        assignBar.hidden = false;

        // 1) Hide the form after submit (per request)
        staffForm.hidden = true;

        // 2) Keep logout link visible so staff can go back if needed
        if (staffBelow) staffBelow.hidden = false;

        // 3) Render and show the cards section
        renderCards();
        if (assignCards) assignCards.hidden = false;

        // Scroll to top so the new box is visible immediately.
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      return false;
    }

  </script>
</body>
</html>
